dataset:
  _target_: galaxea_fm.data.galaxea_lerobot_dataset.GalaxeaLerobotDataset

  dataset_dirs: null

  shape_meta:
    action:
      - key: left_ee_pose
        raw_shape: 7
        shape: 9
      - key: left_gripper
        raw_shape: 1
        shape: 1
      - key: right_ee_pose
        raw_shape: 7
        shape: 9
      - key: right_gripper
        raw_shape: 1
        shape: 1
      - key: torso
        raw_shape: 4
        shape: 4

    state:
      - key: left_ee_pose
        raw_shape: 7
        shape: 9
      - key: left_gripper
        raw_shape: 1
        shape: 1
      - key: right_ee_pose
        raw_shape: 7
        shape: 9
      - key: right_gripper
        raw_shape: 1
        shape: 1
      - key: torso
        raw_shape: 4
        shape: 4
    
    images:
      - key: head_rgb
        raw_shape: 
          - 3
          - 360
          - 640
        shape:
          - 3
          - ${model.model_meta.input_image_size.0}
          - ${model.model_meta.input_image_size.1}
      - key: left_wrist_rgb
        raw_shape: 
          - 3
          - 480
          - 640
        shape: 
          - 3
          - ${model.model_meta.input_image_size.0}
          - ${model.model_meta.input_image_size.1}
      - key: right_wrist_rgb
        raw_shape:
          - 3
          - 480
          - 640
        shape: 
          - 3
          - ${model.model_meta.input_image_size.0}
          - ${model.model_meta.input_image_size.1}

  action_size: 32
  past_action_size: 0
  obs_size: 1
  ee_start_moving_thresh: 0.002
  val_set_proportion: 0.05


processor:
  _target_: galaxea_fm.processors.base_processor.BaseProcessor

  shape_meta: ${data.dataset.shape_meta}
  num_obs_steps: ${data.dataset.obs_size}
  num_output_cameras: 3
  action_output_dim: ${sum_shapes:${data.dataset.shape_meta.action}}
  proprio_output_dim: ${sum_shapes:${data.dataset.shape_meta.state}}

  action_state_transforms:
    - _target_: galaxea_fm.transforms.relative_action.RelativePoseTransform
      keys: [left_ee_pose, right_ee_pose]
    - _target_: galaxea_fm.transforms.relative_action.RelativeJointTransform
      keys: [torso]
    - _target_: galaxea_fm.transforms.rotation.PoseRotationTransform
      rotation_type: rotation_6d
      category_keys:
        action: [left_ee_pose, right_ee_pose]
        state: [left_ee_pose, right_ee_pose]

  # action & state normalization
  use_stepwise_action_norm: True
  norm_default_mode: ${model.model_meta.norm_default_mode}
  norm_exception_mode:
    action:
      left_gripper: "0/100"
      right_gripper: "0/100"
  
  action_state_merger: 
    _target_: galaxea_fm.transforms.action_state_merger.ConcatLeftAlign

  # image transform
  train_transforms:
    head_rgb:
      - _target_: torchvision.transforms.Resize
        size: ${model.model_meta.input_image_size}
      - _target_: galaxea_fm.transforms.image.ToTensor
      - _target_: torchvision.transforms.Normalize
        mean: [0.5, 0.5, 0.5]
        std: [0.5, 0.5, 0.5]
    left_wrist_rgb: ${data.processor.train_transforms.head_rgb}
    right_wrist_rgb: ${data.processor.train_transforms.head_rgb}

  val_transforms:
    head_rgb: 
      - _target_: torchvision.transforms.Resize
        size: ${model.model_meta.input_image_size}
      - _target_: galaxea_fm.transforms.image.ToTensor
      - _target_: torchvision.transforms.Normalize
        mean: [0.5, 0.5, 0.5]
        std: [0.5, 0.5, 0.5]
    left_wrist_rgb: ${data.processor.val_transforms.head_rgb}
    right_wrist_rgb: ${data.processor.val_transforms.head_rgb}

  # instruction
  drop_high_level_prob: 1.0
  use_zh_instruction: False

  tokenizer: ${model.tokenizer}
